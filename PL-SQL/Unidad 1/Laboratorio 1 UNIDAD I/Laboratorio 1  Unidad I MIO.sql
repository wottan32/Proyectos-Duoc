DROP TABLE CUENTA;
DROP TABLE CLIENTE;
DROP TABLE CAJERO;
DROP TABLE DEPOSITO;

--CREACION DE TABLAS
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE TABLE CLIENTE (
RUT VARCHAR2(8) NOT NULL,
NOMBRE VARCHAR2(20) NOT NULL,
DIRECCION VARCHAR2(20) NOT NULL,
COMUNA VARCHAR2(20) NOT NULL,
TELEFONO VARCHAR2(7) NOT NULL,
EDAD VARCHAR2(3) NOT NULL
);
ALTER TABLE CLIENTE ADD CONSTRAINT RUT_PK PRIMARY KEY(RUT);

CREATE TABLE CUENTA(
NUMEROC VARCHAR2(8) NOT NULL,
TIPO VARCHAR2(20) NOT NULL,
FECHA_APERTURA DATE NOT NULL,
SALDO NUMBER(7) NOT NULL,
RUT VARCHAR2(8) 
);
ALTER TABLE CUENTA ADD CONSTRAINT PK_NUMEROC PRIMARY KEY(NUMEROC);
ALTER TABLE CUENTA ADD CONSTRAINT FK_RUT  FOREIGN KEY (RUT) REFERENCES CLIENTE(RUT);


CREATE TABLE CAJERO(
CODIGOC VARCHAR2(2) NOT NULL,
NOMBRE VARCHAR2(20) NOT NULL,
DIRECCION VARCHAR2(20) NOT NULL, 
TELEFONO VARCHAR2(7) NOT NULL
);
ALTER TABLE CAJERO ADD CONSTRAINT PK_CODIGOC PRIMARY KEY(CODIGOC);


 CREATE TABLE DEPOSITO(
 NUMEROD NUMBER(2) NOT NULL,
 CANTIDAD NUMBER(7) NOT NULL,
 TIPO VARCHAR2(20) NOT NULL,
 FECHA_DEPOSITO DATE NOT NULL,
 NUMEROC  VARCHAR2(8) NOT NULL,
 CODIGOC VARCHAR2(2) NOT NULL
 );
 ALTER TABLE DEPOSITO ADD CONSTRAINT PK_NUMEROD PRIMARY KEY(NUMEROD);
 ALTER TABLE DEPOSITO ADD CONSTRAINT FK_NUMEROC  FOREIGN KEY (NUMEROC) REFERENCES CUENTA(NUMEROC);
 ALTER TABLE DEPOSITO ADD CONSTRAINT FK_CODIGOC FOREIGN KEY (CODIGOC) REFERENCES CAJERO(CODIGOC);
 
 
 --INSERCION DE DATOS
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
begin
 --INSERCION DE CLIENTES
 INSERT INTO  CLIENTE VALUES ('10114567', 'Antonio Vera', 'Ecuador 456', 'La Florida', '6543234', '44');
 INSERT INTO  CLIENTE VALUES ('9867543', 'Jorge Pérez', 'Salamanca 486', 'La Florida', '7654345', '47');
 INSERT INTO  CLIENTE VALUES ('8456567', 'Ana Muñoz', 'San Francisco 77', 'Macul', '8325678', '48');
 INSERT INTO  CLIENTE VALUES ('12345654', 'Ricardo Jerez', 'San Juan 44', 'La Florida', '6753456', '40');

--INSERCION DE CUENTAS
 INSERT INTO   CUENTA VALUES ('10111111', 'corriente', TO_DATE('10-10-2010', 'DD-MM-YYYY'), 700000, '10114567');
 INSERT INTO   CUENTA VALUES ('10123333', 'ahorro', TO_DATE('01/05/2012', 'DD-MM-YYYY'), 545000, '8456567');
 INSERT INTO   CUENTA VALUES ('10134444', 'corriente', TO_DATE('09/06/2011', 'DD-MM-YYYY'), 890000, '9867543');
 INSERT INTO   CUENTA VALUES ('10145555', 'ahorro', TO_DATE('10/04/2012', 'DD-MM-YYYY'), 450000, '10114567');
 INSERT INTO   CUENTA VALUES ('10157777', 'ahorro', TO_DATE('06/04/2009', 'DD-MM-YYYY'), 37000, '12345654');
 INSERT INTO   CUENTA VALUES ('11525888', 'vista', TO_DATE('07/09/2008', 'DD-MM-YYYY'), 56000, '9867543');

  --INSERCION DE CAJEROS
INSERT INTO CAJERO VALUES('10', 'Alejandro Cofre', 'Porto Seguro 88', '5674343');
INSERT INTO CAJERO VALUES('20', 'Mauricio Yañez', 'Los presidentes 345', '6754323');
INSERT INTO CAJERO VALUES('30', 'Alejandra Vera', 'Los Sauces 55', '8643245');
INSERT INTO CAJERO VALUES('40', 'Claudia Perez', 'Alpes 34', '8643245');

 
 --INSERCION DE DEPOSITOS
 INSERT INTO DEPOSITO VALUES(10, 54000, 'Efectivo', TO_DATE('10/02/2015', 'DD-MM-YYYY'), '10111111', '30');
 INSERT INTO DEPOSITO VALUES(11, 100000, 'Cheque', TO_DATE('05/03/2015', 'DD-MM-YYYY'), '10123333', '10');
 INSERT INTO DEPOSITO VALUES(12, 75000, 'Efectivo', TO_DATE('10/03/2015', 'DD-MM-YYYY'), '10157777', '30');
 INSERT INTO DEPOSITO VALUES(13, 95000, 'Efectivo', TO_DATE('20/01/2015', 'DD-MM-YYYY') , '10123333', '20');
 INSERT INTO DEPOSITO VALUES(14, 20000, 'Cheque', TO_DATE('15/02/2015', 'DD-MM-YYYY'), '10145555', '40');


end;
1. Mostrar el nombre, edad y comuna de los clientes que poseen cuentas de ahorro y no cuentas corrientes en el banco.
SELECT CLIENTE.nombre "Nombre", CLIENTE.edad "Edad", CLIENTE.comuna "Comuna" from  CLIENTE, CUENTA  cl
WHERE cl.RUT IN (
SELECT RUT FROM CUENTA
WHERE TIPO='ahorro' AND NOT 'corriente'
);

2. Mostrar el promedio de los depósitos hechos por Ana Muñoz.
SELECT AVG(DEPOSITO.CANTIDAD) FROM CLIENTE, CUENTA, DEPOSITO WHERE ( 
CLIENTE.RUT=
(SELECT CLIENTE.RUT FROM CLIENTE WHERE CLIENTE.NOMBRE='Ana Muñoz'))


3. Mostrar el nombre de los cajeros que atendieron el depósito de Antonio Vera y Ana Muñoz.
SELECT CAJERO.NOMBRE FROM CLIENTE, CUENTA,DEPOSITO, CAJERO WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.NUMEROC=DEPOSITO.NUMEROC AND DEPOSITO.CODIGOC=CAJERO.CODIGOC AND CLIENTE.NOMBRE='Antonio Vera' AND CLIENTE.NOMBRE='Ana Muñoz';

4. Mostrar la suma y promedio del o los depósitos de las cuentas de ahorro.
SELECT CUENTA.NUMEROC "Numeo de Cuenta", AVG(CANTIDAD)"Promedio de Depositos", SUM(CANTIDAD)"Suma de Depositos" FROM CUENTA, DEPOSITO WHERE CUENTA.NUMEROC=DEPOSITO.NUMEROC group by CUENTA.NUMEROC;

5. Mostrar la suma de los saldos de Jorge Pérez.
SELECT SUM(SALDO)"Suma de Saldos de Jorge Pérez" FROM CUENTA WHERE CUENTA.RUT IN (SELECT CLIENTE.RUT FROM CLIENTE WHERE NOMBRE='Jorge Pérez');

6. Mostrar cuantos depósitos hay a cuentas corrientes.
SELECT CUENTA.NUMEROC"Numero de Cuenta", count (DEPOSITO.NUMEROC) FROM CUENTA, DEPOSITO WHERE CUENTA.NUMEROC=DEPOSITO.NUMEROC GROUP BY CUENTA.NUMEROC
--Problema, no cuentan las cuentas sin depositos

7. Mostrar los tipos y saldos de las cuentas que realizaron depósitos menores de 50000.
SELECT CUENTA.TIPO, CUENTA.SALDO FROM CUENTA, DEPOSITO WHERE CUENTA.NUMEROC=DEPOSITO.NUMEROC AND DEPOSITO.CANTIDAD<50000

8. Mostrar todos los datos de los clientes que tienen saldos en sus cuentas mayores a 55000.
SELECT DISTINCT(CLIENTE.RUT), CLIENTE.NOMBRE, CLIENTE.DIRECCION, CLIENTE.COMUNA, CLIENTE.TELEFONO, CLIENTE.EDAD
FROM CLIENTE, CUENTA
WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.SALDO>55000

9. Mostrar el nombre de los clientes que hicieron depósitos en febrero del 2015.
SELECT DISTINCT(NOMBRE) FROM CLIENTE, CUENTA, DEPOSITO WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.NUMEROC=DEPOSITO.NUMEROC AND DEPOSITO.FECHA_DEPOSITO BETWEEN TO_DATE('01-02-2015', 'DD-MM-YYYY') AND TO_DATE('28-02-2015', 'DD-MM-YYYY');

10. Mostrar el nombre y dirección de los clientes cuyos saldos no estén entre 55000 y 75000 pesos
SELECT DISTINCT(NOMBRE) ,DIRECCION FROM CLIENTE, CUENTA WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.SALDO NOT BETWEEN 55000 AND 75000;

11. Mostrar el nombre, dirección y comuna de los clientes que poseen cuentas de ahorro en el banco.
SELECT DISTINCT(NOMBRE), DIRECCION, COMUNA FROM CLIENTE, CUENTA WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.TIPO='ahorro';

12. Mostrar el promedio de los depósitos hechos por Ana Muñoz y Alejandro Cofré.
SELECT AVG(DEPOSITO.CANTIDAD) FROM CLIENTE,CUENTA,DEPOSITO WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.NUMEROC=DEPOSITO.NUMEROC AND CLIENTE.NOMBRE='Ana Muñoz' AND CLIENTE.NOMBRE='Alejandro Cofré' GROUP BY CLIENTE.RUT

13. Mostrar los datos del o los clientes que poseen cuenta vista en el banco.
SELECT DISTINCT(CLIENTE.RUT)"Rut", NOMBRE"Nombre", DIRECCION"Dirección", COMUNA"Comuna", TELEFONO"Teléfono", EDAD"Edad" FROM CLIENTE, CUENTA WHERE CLIENTE.RUT=CUENTA.RUT AND CUENTA.TIPO='vista' ;

14. Mostrar los nombre de los cajeros que atendieron depósitos en Enero del 2015.
SELECT CAJERO.NOMBRE FROM CAJERO,DEPOSITO WHERE DEPOSITO.CODIGOC=CAJERO.CODIGOC AND DEPOSITO.FECHA_DEPOSITO BETWEEN TO_DATE('01-01-2015', 'DD-MM-YYYY') AND TO_DATE('31-01-2015', 'DD-MM-YYYY');

15. Mostrar el promedio de los saldos de Jorge Pérez y Mauricio Yáñez.
SELECT AVG(SALDO) FROM CLIENTE, CUENTA WHERE CLIENTE.NOMBRE='Jorge Pérez' AND CLIENTE.NOMBRE='Mauricio Yáñez', GROUP BY CLIENTE.RUT;

16. Mostrar los números de depósitos de las cuentas de ahorro.
SELECT COUNT(NUMEROC)"Cantidad cuentas ahorro" FROM CUENTA WHERE TIPO='ahorro';

17. Mostrar los tipos y saldos de las cuentas que realizaron depósitos en marzo del 2015.
SELECT CUENTA.TIPO, CUENTA.SALDO FROM CUENTA, DEPOSITO WHERE CUENTA.NUMEROC=DEPOSITO.NUMEROC AND FECHA_DEPOSITO BETWEEN TO_DATE('01-02-2015', 'DD-MM-YYYY') AND TO_DATE('28-02-2015', 'DD-MM-YYYY');

18. Mostrar todos los datos de los clientes que tienen saldos en sus cuentas mayores de 55000 y de tipo corriente.
SELECT DISTINCT(CLIENTE.RUT)"Rut", NOMBRE"Nombre", DIRECCION"Dirección", COMUNA"Comuna", TELEFONO"Teléfono", EDAD"Edad" FROM CLIENTE, CUENTA WHERE CLIENTE.RUT=CUENTA.RUT AND SALDO>55000 AND TIPO='corriente';

19. Mostrar todos los datos del cajero que hizo el depósito cuya cantidad no es 54000.
SELECT CODIGOC, NOMBRE, DIRECCION, TELEFONO FROM CAJERO, DEPOSITO WHERE DEPOSITO.CODIGOC=CAJERO.CODIGOC AND CANTIDAD!=54000;

20. Mostrar el nombre y dirección de los clientes cuyos saldos estén entre 55000 y 75000 pesos.
SELECT NOMBRE, DIRECCION FROM CLIENTE, CUENTA WHERE CLIENTE.RUT=CUENTA.RUT AND SALDO BETWEEN 55000 AND 75000;




 
 
 
 create view  vista1(Nombre) as 
select nombre_autor 
from autor 
where cod_autor in (
select id_autor
from libro
where nom_editorial = 'antares');
 
